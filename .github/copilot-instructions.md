# Copilot Instructions

このファイルは、GitHub Copilot Agentが本プロジェクトで効果的に作業するための学習と参照用ドキュメントです。

## プロジェクト概要
- プロジェクト名：UniversalCamerawork (UCAPI)
- 目的：複数プラットフォーム（Unity、Unreal、Blenderなど）間でカメラ状態情報（位置、回転、ズームレベル）を共通バイナリ形式でシリアライズ／デシリアライズし共有するC++ DLLを開発する。
- コア機能：
  - 独自バイナリ形式でのシリアライズ、CRC16整合性チェック
  - バイナリ→プラットフォームネイティブ型への変換（MessagePack併用オプション）
  - テストツール（C#ユーティリティ）による自動化テスト

## プロジェクト構造・パターン
- `UCAPIProject/UCAPI/`：C++ DLLコード（`UCAPI_DLL`）、C#テストツール（`UCAPI_TestTool`）
- モジュール層：Core API → シリアライザ → コンバータ → テスト
- デザインパターン：Singleton（ロガー、設定管理）、Factory（シリアライザ／コンバータ生成）、Strategy（シリアライズ形式切替）、Observer（更新通知）
- 命名規則：
  - ファイル/クラス名は `ucapi_` プレフィックス
  - ヘッダファイル拡張子 `.h`, 実装 `.cpp`
  - C# テストツールは PascalCase

## 開発・テスト
- C++ コンパイル：Visual Studio 2022, MSVC, C++17
- C++ テスト：GoogleTest（外部ヘッダ統合）
- C# テスト：NUnit
- 自動テスト実行：`run_ucapi_testtool.bat`

## ドキュメント・仕様
- `docs/UCAPI_Data_Format_Specification.yaml` にバイナリフォーマット詳細
- README.md にセットアップ手順と使用例

## コーディングガイドライン
- 依存最小化：STL 使用を必要最小限に抑え、シングルヘッダライブラリを優先
- エラーハンドリング：HRESULT または例外併用（DLL APIでは戻り値とエラーログ）
- パフォーマンス：メモリアロケーション抑制、データコピー最小化
- セキュリティ：将来の暗号化／アクセス制御機構設計を考慮

## 学習すべきポイント
- プラットフォーム依存の変換処理はDLLコアではなく、各プラットフォーム側のプラグインで実装する。
- リングバッファ／LMAX Disruptor は同列ではなく、Disruptorはリングバッファを拡張したモデル。選択肢として必要に応じて採用する。
- ローカルPC内通信とネットワーク通信は、Transportレイヤで実装を切り替え可能な抽象化（Strategy）を用意し、同一インターフェースで利用できる。
- FlatBuffersまたはCap’n Protoの導入推奨。将来の新しいシリアライズライブラリに対応できるよう、IMessageSerializerインターフェースを定義し、Factory経由で切り替え可能に実装する。

## 継続的学習ポイント
- プラグイン式コンバータ登録機構の拡張方法
- プラットフォーム別のDLLロード／呼び出しサンプル
- シリアライザフォーマットの後方互換性管理

## 重要な履歴
1. メモリバンク構造の定義と初期ドキュメント作成 (2025-06-19)
2. DLLコア機能の実装計画

---
*更新時は必ず本ファイルにパターンや設定を追記し、後続作業で参照すること。*
